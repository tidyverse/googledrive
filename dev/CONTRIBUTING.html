<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to googledrive • googledrive</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to googledrive"><meta property="og:image" content="https://googledrive.tidyverse.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="googledrive.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">googledrive</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/googledrive.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/file-identification.html">File Identification</a></li>
    <li><a class="dropdown-item" href="articles/multiple-files.html">Dealing with multiple files</a></li>
    <li><a class="dropdown-item" href="articles/permissions.html">File permissions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package configuration</h6></li>
    <li><a class="dropdown-item" href="articles/bring-your-own-client.html">Bring your own OAuth client or API key</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/07/googledrive-2-0-0/">Version 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/08/googledrive-1-0-0/">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/googledrive/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Contributing to googledrive</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/googledrive/blob/main/.github/CONTRIBUTING.md" class="external-link"><code>.github/CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-googledrive" class="section level1">

<ul><li><a href="#making-a-pull-request">Making a pull request</a></li>
<li><a href="#package-philosophy">Package philosophy</a></li>
<li>
<a href="#package-mechanics">Package mechanics</a>
<ul><li><a href="#documentation">Documentation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#continuous-integration">Continuous integration</a></li>
</ul></li>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
</ul><div class="section level2">
<h2 id="making-a-pull-request">Making a pull request<a class="anchor" aria-label="anchor" href="#making-a-pull-request"></a></h2>
<ul><li>Uphold the design principles and package mechanics outlined below.</li>
<li>When in doubt, discuss in an issue before doing lots of work.</li>
<li>Make sure the package still passes <code>R CMD check</code> locally for you. It’s a good idea to do that before you touch anything, so you have a baseline.</li>
<li>Match the existing code style. Our intent is to follow <a href="https://style.tidyverse.org" class="external-link uri">https://style.tidyverse.org</a>. Please use the <a href="https://styler.r-lib.org" class="external-link">styler package</a> to re-style any code that you touch.</li>
<li>Tests: please <em>try</em> to run our tests or at least those that exercise your PR. Add tests, if relevant. If things go sideways, just say so. We are painfully aware that it’s not easy to test API-wrapping, auth-requiring packages like googledrive and are open to constructive feedback. More below.</li>
<li>Documentation: Update the documentation source, if your PR changes any behavior. We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, so you must edit the roxygen comments above the function; never edit <code>NAMESPACE</code> or <code>.Rd</code> files by hand. More below.</li>
<li>Website: The pkgdown-created website is built and deployed automatically via Travis-CI. Some changes require an edit to the <code>reference</code> section of <code>_pkgdown.yml</code>, i.e. to make sure that a function appears there.</li>
<li>If the PR is related to an issue, link to it in the description, with <a href="https://help.github.com/articles/autolinked-references-and-urls/" class="external-link">the <code>#15</code> syntax</a> and the issue slug for context. If the PR is meant to close an issue, make sure one of the commit messages includes <a href="https://help.github.com/articles/closing-issues-using-keywords/" class="external-link">text like <code>closes #44</code> or <code>fixes #101</code></a>. Provide the issue number and slug in the description, even if the issue is mentioned in the title, because auto-linking does not work in the PR title.
<ul><li>GOOD PR title: “Obtain user’s intent via mind-reading; fixes #86”.</li>
<li>BAD PR title: “Fixes #1043”. Please remind us all what issue #1043 is about!</li>
<li>BAD PR title: “Something about #345”. This will not actually close issue #345 upon merging. <a href="https://help.github.com/articles/closing-issues-using-keywords/" class="external-link">Use the magic words</a>.</li>
</ul></li>
<li>Add a bullet to <code>NEWS.md</code> with a concise description of the change, if it’s something a user would want to know when updating the package. <a href="https://github.com/tidyverse/dplyr/blob/main/NEWS.md" class="external-link">dplyr’s <code>NEWS.md</code></a> is a good source of examples. Note the sentence format, the inclusion of GitHub username, and links to relevant issue(s)/PR(s). We will handle any organization into sub-sections just prior to a release. What merits a bullet?
<ul><li>Fixing a typo in the docs does not, but it is still awesome and deeply appreciated.</li>
<li>Fixing a bug or adding a new feature is bullet-worthy.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="package-philosophy">Package philosophy<a class="anchor" aria-label="anchor" href="#package-philosophy"></a></h2>
<ul><li>When in doubt, take a cue from the Unix file system commands or the Google Drive browser UI.</li>
<li>Have a reasonable default whenever humanly possible. This applies to auth, file name, file location, etc.</li>
<li>Be pipe-friendly.</li>
<li>If it’s not well-documented (e.g. working example!), it doesn’t really exist.</li>
<li>Accommodate initial file specification via path or name, but constantly push downstream work to be based on file id.</li>
<li>Return a tidy tibble, almost always a <a href="https://tidyverse.github.io/googledrive/reference/dribble.html" class="external-link"><code>dribble</code></a>, whenever it makes sense.</li>
</ul><p>There is a high-level interface for the typical user. These functions help you accomplish the most common tasks, hopefully in a natural way. Examples: <code><a href="reference/drive_find.html">drive_find()</a></code>, <code><a href="reference/drive_upload.html">drive_upload()</a></code>, <code><a href="reference/drive_download.html">drive_download()</a></code>. A few hand-picked functions support passing extra parameters through to the API request via <code>...</code>, but we don’t do this across the board.</p>
<p>There is also a low-level interface that is used internally. An example is the function <code><a href="reference/request_generate.html">request_generate()</a></code>. These functions are exported for use by programming-oriented users who are willing to read <a href="https://developers.google.com/drive/v3/web/about-sdk" class="external-link">Drive API docs</a> and want to do things we haven’t made available in the high-level interface.</p>
</div>
<div class="section level2">
<h2 id="package-mechanics">Package mechanics<a class="anchor" aria-label="anchor" href="#package-mechanics"></a></h2>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<p>We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, specifically with the <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/markdown.html" class="external-link">Markdown syntax</a>, to create <code>NAMESPACE</code> and all <code>.Rd</code> files. All edits to documentation should be done in roxygen comments above the associated function or object.</p>
<p>Use templates or inheritance to repeat documentation whenever it is helpful, but without actually repeating its source.</p>
<p>Use internal and external links liberally, i.e. to other docs in googledrive or to Drive API resources.</p>
<p>We encourage working examples that include any necessary setup and teardown. In most cases, you’ll have to put them inside a <code>\dontrun{}</code>.</p>
<p>It’s nice if a pull request includes the result of running <code>devtools::document()</code>, to update <code>NAMESPACE</code> and the <code>.Rd</code> files, but that’s optional. A good reason to NOT <code>document()</code> is if you have a different version of roxygen2 installed and that sprays minor formatting changes across <code>.Rd</code> files that have nothing to do with the PR.</p>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<p>We use <a href="https://cran.r-project.org/package=testthat" class="external-link">testthat</a>.</p>
<p>We have many tests that (1) require authorization and that (2) rely on the existence of specific files and folders. Therefore, to fully test googledrive, you have to do some setup.</p>
<p>For small changes, it’s fine to test your specific change locally and make a PR. Keep reading for an explanation of how to run full tests for googledrive.</p>
<div class="section level4">
<h4 id="auth">Auth<a class="anchor" aria-label="anchor" href="#auth"></a></h4>
<p>A token is put into force at the beginning of a test run by the first few lines of <a href="https://github.com/tidyverse/googledrive/blob/main/tests/testthat/helper.R" class="external-link">tests/testthat/helper.R</a>.</p>
<ul><li>This reflects the approach documented in the gargle vignette <a href="https://gargle.r-lib.org/articles/articles/managing-tokens-securely.html" class="external-link">Managing tokens securely</a>. We use embedded, encrypted service account token.</li>
<li>If you want to use a token you already have, edit those lines to use any of the techniques described in the gargle vignette <a href="https://gargle.r-lib.org/articles/non-interactive-auth.html" class="external-link">Non-interactive auth</a>. Don’t commit and submit this change as part of a pull request; just use it as a pragmatic way to run tests with a token you have on hand.</li>
</ul></div>
<div class="section level4">
<h4 id="r-scripts-for-setup-and-clean">R scripts for setup and clean<a class="anchor" aria-label="anchor" href="#r-scripts-for-setup-and-clean"></a></h4>
<p>For speed reasons, the googledrive tests expect to find certain pre-existing files and folders, i.e. we don’t do full setup and tear down on each run. You do setup at the beginning of your googledrive development and leave these files in place while you work. When you’re done, e.g., when your PR is complete, you can clean up these files. Each test run also creates and destroys files, both locally and on Drive, but that is different and not what we’re talking about here.</p>
<ol style="list-style-type: decimal"><li>
<p>Source <code>tests/testthat/driver.R</code> to extract and aggregate the current setup and clean code across all test files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## gather all the test setup and clean code from individual test files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_path.html" class="external-link">test_path</a></span><span class="op">(</span><span class="st">"driver.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## leaves behind:</span></span>
<span><span class="co">##   * all-test-setup.R</span></span>
<span><span class="co">##   * all-test-clean.R</span></span></code></pre></div>
<ul><li>This creates two R scripts: <code>tests/testthat/all-test-setup.R</code> and <code>tests/testthat/all-test-clean.R</code>. Inspect them.</li>
</ul></li>
<li><p>When you are truly ready to perform setup or clean, edit the code to set the <code>SETUP</code> or <code>CLEAN</code> variable to <code>TRUE</code> instead of <code>FALSE</code>. This friction is intentional, so you don’t accidentally create or delete lots of Drive files without meaning to.</p></li>
<li><p>Render <code>all-test-setup.R</code> with the Knit button in RStudio or like so:</p></li>
</ol><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_path.html" class="external-link">test_path</a></span><span class="op">(</span><span class="st">"all-test-setup.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You could also just source it, but it’s nice to have a report that records what actually happened.</p>
<p>You should now be able to run the tests via <em>Build &gt; Test Package</em> or <em>Build &gt; Check Package</em> in RStudio or via <code>devtools::test()</code>.</p>
<p>You can leave the setup in place for as long as you’re working on googledrive, i.e. you don’t need to do this for every test run. In fact, that is the whole point!</p>
<p>When your googledrive development is over, render the clean script:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_path.html" class="external-link">test_path</a></span><span class="op">(</span><span class="st">"all-test-clean.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Again, read the report to look over what happened, in case anything was trashed that should not have been (btw, let us know about that so we can fix!). Once you’re satisfied that your own files were not touched, you can <code><a href="reference/drive_empty_trash.html">drive_empty_trash()</a></code> to truly delete the test files.</p>
</div>
<div class="section level4">
<h4 id="adding-tests">Adding tests<a class="anchor" aria-label="anchor" href="#adding-tests"></a></h4>
<p>If you’re going to add or modify tests, follow these conventions:</p>
<ul><li>Test files are marked up with knitr chunk headers in comments, e.g. <code># ---- clean ----</code> or <code># ---- tests ----</code>. This is what enables the <code>driver.R</code> script to isolate the setup or cleaning code. Don’t break that.</li>
<li>Any file that is truly necessary and can be setup in advance and persist? Do it, in order to make future test runs faster. Put the associated setup and clean code at the top of the test file.</li>
<li>All test files should have a name that documents why they exist and who made them. Use the <code># ---- nm_fun ----</code> chunk to define naming functions used in that test file (see existing files for examples). Always use one of these functions to generate file names. Use <code>nm_()</code> for test files that persist. Use <code>me_()</code> for ephemeral test files that are created and destroyed in one test run.</li>
</ul><p>Example and structure of a self-documenting name for a persistent test file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>move<span class="sc">-</span>files<span class="sc">-</span>into<span class="sc">-</span>me<span class="sc">-</span>TEST<span class="sc">-</span>drive<span class="sc">-</span>mv</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="sc">&lt;</span>informative<span class="sc">-</span>slug<span class="sc">&gt;-</span>TEST<span class="sc">-</span><span class="er">&lt;</span>test<span class="sc">-</span>context<span class="sc">&gt;</span></span></code></pre></div>
<p>Example and structure of a self-documenting name for an ephemeral test file:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>DESCRIPTION<span class="sc">-</span>TEST<span class="sc">-</span>drive<span class="sc">-</span>upload<span class="sc">-</span>travis</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="sc">&lt;</span>informative<span class="sc">-</span>slug<span class="sc">&gt;-</span>TEST<span class="sc">-</span><span class="er">&lt;</span>test<span class="sc">-</span>context<span class="sc">&gt;-</span><span class="er">&lt;</span>user<span class="sc">&gt;</span></span></code></pre></div>
<p>Note that the current user is appended! This is so that concurrent test runs do not attempt to edit the same files.</p>
</div>
</div>
<div class="section level3">
<h3 id="continuous-integration">Continuous integration<a class="anchor" aria-label="anchor" href="#continuous-integration"></a></h3>
<p>googledrive is checked on a large matrix of R versions and operating systems via GitHub Actions. We use <a href="https://codecov.io/github/tidyverse/googledrive?branch=main" class="external-link">codecov</a> to track the test coverage. In general, the package is subjected to <code>R CMD check</code>, unit tests, and test coverage analysis after every push to GitHub. For internal branches, an encrypted service account token is available on GHA, so tests against the Drive API can be run.</p>
<p>Things are a bit different for pull requests from outside contributors, however. These PRs do not have access to the encrypted tokens, therefore many tests must be skipped. The PR will still be vetted via <code>R CMD check</code> and tests that do not call the Drive API can still be run. After you make a PR, it’s a good idea to check back after a few minutes to see all of these results. If there are problems, read the log and try to correct the problem proactively. We “squash and merge” most pull requests, internal or external, so don’t agonize over the commit history.</p>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a></h2>
<p>Please note that the googledrive project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project you agree to abide by its terms.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Lucy D’Agostino McGowan, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

  </div></footer></body></html>

